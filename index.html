<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT Token Cost Calculator</title>
    <style>
        :root {
            --sidebar-w: 260px; --brand: #2563eb; --bg-app: #f8fafc;
            --card-bg: #ffffff; --text-main: #1e293b; --text-muted: #64748b;
            --border: #e2e8f0; --accent-bg: #f0f7ff;
            --t1: #dbeafe; --t2: #fef3c7; --t3: #dcfce7; --t4: #f3e8ff;
        }
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-app: #0f172a; --card-bg: #1e293b; --text-main: #f1f5f9;
                --text-muted: #94a3b8; --border: #334155; --accent-bg: #1e293b;
            }
        }
        
        body { 
            margin: 0; font-family: 'Inter', system-ui, sans-serif; background: var(--bg-app); color: var(--text-main);
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }

        .app-grid { 
            display: grid; grid-template-areas: "header" "main"; grid-template-columns: 1fr; min-height: 100vh; 
        }

        @media (min-width: 1024px) {
            .app-grid { grid-template-areas: "sidebar header" "sidebar main"; grid-template-columns: var(--sidebar-w) 1fr; grid-template-rows: 70px 1fr; }
        }

        aside {
            grid-area: sidebar; background: var(--card-bg); padding: 24px; border-right: 1px solid var(--border);
            display: flex; flex-direction: column; position: fixed; left: -100%; top: 0; bottom: 0; z-index: 2000; width: var(--sidebar-w); transition: 0.3s;
        }
        aside.open { left: 0; }
        @media (min-width: 1024px) { aside { position: sticky; top: 0; height: 100vh; left: 0; } }

        header {
            grid-area: header; height: 70px; background: var(--card-bg); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; padding: 0 24px; justify-content: space-between; position: sticky; top: 0; z-index: 1000;
        }

        main { grid-area: main; padding: 24px; width: 100%; box-sizing: border-box; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .glass-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; padding: 16px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }

        .workspace-layout { display: grid; grid-template-columns: 1fr; gap: 24px; }
        @media (min-width: 1280px) { .workspace-layout { grid-template-columns: 3fr 2fr; } }

        textarea {
            width: 100%; min-height: 350px; padding: 18px; border-radius: 12px; border: 1px solid var(--border);
            background: var(--bg-app); color: var(--text-main); font-size: 15px; line-height: 1.6; outline: none; box-sizing: border-box; font-weight: 400;
        }

        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { text-align: left; padding: 12px; color: var(--text-muted); font-size: 10px; text-transform: uppercase; border-bottom: 1px solid var(--border); }
        td { padding: 12px; border-bottom: 1px solid var(--border); font-weight: 400; }
        .num { font-family: monospace; text-align: right; }
        .total { background: var(--accent-bg); color: var(--brand); font-weight: 600; }
        .token-span { padding: 2px 4px; border-radius: 4px; margin: 1px; display: inline-block; font-family: monospace; font-size: 12px; font-weight: 400; }
        
        .btn { padding: 8px 14px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-main); font-weight: 500; cursor: pointer; }
        .btn-primary { background: var(--brand); color: white; border: none; }
        .btn-danger { color: #ef4444; border-color: #fee2e2; }
    </style>
</head>
<body>

<div class="app-grid">
    <aside id="sidebar">
        <h2 style="color:var(--brand); margin:0; font-size: 22px;">GPT Calc</h2>
        <div id="history-list" style="flex:1; overflow-y:auto; margin: 20px 0;"></div>
        <button class="btn btn-primary" style="margin-bottom:8px;" onclick="saveToHistory()">ðŸ’¾ Save Workspace</button>
        <button class="btn btn-danger" onclick="clearHistory()">ðŸ—‘ Clear History</button>
    </aside>

    <header>
        <div style="display:flex; align-items:center; gap:12px;">
            <div class="btn" onclick="toggleMenu()" style="display:inline-block;">â˜°</div>
            <select id="task-preset" onchange="renderPricing()" class="btn">
                <option value="1">1:1 (Chat)</option>
                <option value="0.3">Summarization (Small Out)</option>
                <option value="3">Creative Writing (Large Out)</option>
                <option value="0.1">Data Extraction (Tiny Out)</option>
            </select>
        </div>
        <div style="display:flex; gap:8px;">
            <button class="btn" onclick="showExample()">Example</button>
            <button class="btn" onclick="clearEditor()" style="color:#ef4444">Clear</button>
            <select id="currency-select" onchange="changeCurrency(this.value)" class="btn">
                <option value="USD">USD ($)</option>
                <option value="EUR">EUR (â‚¬)</option>
                <option value="INR">INR (â‚¹)</option>
            </select>
        </div>
    </header>

    <main>
        <div class="stats-grid">
            <div class="glass-card">
                <small style="color:var(--text-muted); font-weight:600;">TOKENS</small>
                <div id="t-count" style="font-size:24px; font-weight:700;">0</div>
            </div>
            <div class="glass-card">
                <small style="color:var(--text-muted); font-weight:600;">AVG. TOTAL COST</small>
                <div id="avg-cost" style="font-size:24px; font-weight:700; color:var(--brand);">$0.00</div>
            </div>
        </div>

        <div class="workspace-layout">
            <div>
                <textarea id="token-input" placeholder="Paste your prompt text here to see the 2026 cost breakdown..."></textarea>
                <div class="glass-card" style="margin-top:20px;">
                    <div id="visualizer"></div>
                </div>
            </div>
            <div class="glass-card" style="padding:0; overflow:hidden;">
                <table>
                    <thead>
                        <tr><th>Model</th><th class="num">In</th><th class="num">Out</th><th class="num">Total</th></tr>
                    </thead>
                    <tbody id="price-table-body"></tbody>
                </table>
                <div style="padding:12px; font-size:11px; color:var(--text-muted);">
                    * Costs are based on Price per 1 Million Tokens.
                </div>
            </div>
        </div>
    </main>
</div>

<script src="https://unpkg.com/gpt-tokenizer/dist/cl100k_base.js"></script>
<script>
    let currentTokenCount = 0; let modelData = []; let exchangeRates = { USD: 1 };
    let selectedCurrency = 'USD'; const symbols = { USD: '$', EUR: 'â‚¬', INR: 'â‚¹' };

    async function init() {
        try {
            const [mRes, rRes] = await Promise.all([
                fetch('models.json'),
                fetch('https://api.frankfurter.dev/v1/latest?base=USD')
            ]);
            modelData = await mRes.json();
            exchangeRates = { ...exchangeRates, ...(await rRes.json()).rates };
            renderHistory(); renderPricing();
        } catch (e) { console.warn("Init failed. Check models.json."); }
    }

    function toggleMenu() { document.getElementById('sidebar').classList.toggle('open'); }
    function changeCurrency(cc) { selectedCurrency = cc; renderPricing(); }
    function clearEditor() { document.getElementById('token-input').value = ''; updateUI(''); }
    function clearHistory() { if(confirm("Clear all history?")) { localStorage.removeItem('ai_history'); renderHistory(); } }
    
    function showExample() {
        const text = "Tokenization is the magic behind GPT models. It turns your words into numbers. In 2026, we measure costs per 1,000,000 tokens.";
        document.getElementById('token-input').value = text;
        updateUI(text);
    }

    function formatPrice(usd) {
        const val = usd * (exchangeRates[selectedCurrency] || 1);
        const s = symbols[selectedCurrency];
        return s + (val === 0 ? "0.00" : (val < 0.01 ? val.toFixed(4) : val.toLocaleString(undefined, {minimumFractionDigits: 2})));
    }

    function renderPricing() {
        const body = document.getElementById('price-table-body');
        const ratio = parseFloat(document.getElementById('task-preset').value);
        body.innerHTML = ''; let sum = 0;
        
        modelData.forEach(m => {
            const inC = (currentTokenCount / 1000000) * m.input;
            const outC = ((currentTokenCount * ratio) / 1000000) * m.output;
            const total = inC + outC; sum += total;
            body.innerHTML += `<tr>
                <td><b>${m.name}</b></td>
                <td class="num">${formatPrice(inC)}</td>
                <td class="num">${formatPrice(outC)}</td>
                <td class="num total">${formatPrice(total)}</td>
            </tr>`;
        });
        document.getElementById('avg-cost').innerText = formatPrice(modelData.length ? sum / modelData.length : 0);
    }

    function updateUI(text) {
        const tokens = text ? GPTTokenizer_cl100k_base.encode(text) : [];
        currentTokenCount = tokens.length;
        document.getElementById('t-count').innerText = currentTokenCount.toLocaleString();
        
        const vis = document.getElementById('visualizer');
        vis.innerHTML = '<small style="display:block;margin-bottom:8px;color:var(--text-muted)">Token Visualization:</small>';
        tokens.slice(0, 100).forEach((id, i) => {
            const span = document.createElement('span'); span.className = 'token-span';
            span.style.background = `var(--t${(i % 4) + 1})`;
            span.textContent = GPTTokenizer_cl100k_base.decode([id]);
            vis.appendChild(span);
        });
        renderPricing();
    }

    function saveToHistory() {
        const text = document.getElementById('token-input').value; if (!text) return;
        let history = JSON.parse(localStorage.getItem('ai_history') || '[]');
        history.unshift({ id: Date.now(), text, date: new Date().toLocaleTimeString() });
        localStorage.setItem('ai_history', JSON.stringify(history.slice(0, 10)));
        renderHistory();
    }

    function renderHistory() {
        const history = JSON.parse(localStorage.getItem('ai_history') || '[]');
        document.getElementById('history-list').innerHTML = history.length ? history.map(h => `
            <div onclick="loadHistory('${h.id}')" style="padding:10px; border:1px solid var(--border); border-radius:8px; cursor:pointer; margin-bottom:8px; font-size:12px;">
                <b>${h.date}</b><br><span style="color:var(--text-muted)">${h.text.substring(0, 35)}...</span>
            </div>
        `).join('') : '<p style="font-size:12px; color:var(--text-muted);">No saved history.</p>';
    }

    function loadHistory(id) {
        const item = JSON.parse(localStorage.getItem('ai_history')).find(h => h.id == id);
        if (item) { document.getElementById('token-input').value = item.text; updateUI(item.text); }
    }

    document.getElementById('token-input').addEventListener('input', (e) => updateUI(e.target.value));
    init();
</script>
</body>
</html>
