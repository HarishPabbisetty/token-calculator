<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT Token Cost Calculator</title>
    <style>
        :root {
            --sidebar-w: 280px; --brand: #2563eb; --bg-app: #f8fafc;
            --card-bg: #ffffff; --text-main: #1e293b; --text-muted: #64748b;
            --border: #e2e8f0; --accent-bg: #f0f7ff;
            --t1: #dbeafe; --t2: #fef3c7; --t3: #dcfce7; --t4: #f3e8ff;
        }
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-app: #0f172a; --card-bg: #1e293b; --text-main: #f1f5f9;
                --text-muted: #94a3b8; --border: #334155; --accent-bg: #1e293b;
            }
        }
        body { margin: 0; font-family: 'Inter', system-ui, sans-serif; background: var(--bg-app); color: var(--text-main); }
        .app-grid { display: flex; flex-direction: column; min-height: 100vh; }
        @media (min-width: 1024px) { .app-grid { display: grid; grid-template-columns: var(--sidebar-w) 1fr; grid-template-rows: 70px 1fr; } }

        /* Sidebar & Header */
        aside {
            background: var(--card-bg); padding: 24px; border-right: 1px solid var(--border);
            display: flex; flex-direction: column; position: fixed; left: -100%; top: 0; bottom: 0; z-index: 2000; width: var(--sidebar-w); transition: 0.3s;
        }
        aside.open { left: 0; }
        @media (min-width: 1024px) { aside { position: static; grid-row: 1/3; } }
        header {
            height: 70px; background: var(--card-bg); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; padding: 0 24px; justify-content: space-between; position: sticky; top: 0; z-index: 1000;
        }

        /* Workspace Components */
        main { padding: 24px; width: 100%; box-sizing: border-box; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .glass-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 16px; padding: 20px; margin-bottom: 24px; }
        .workspace-layout { display: grid; grid-template-columns: 1fr; gap: 24px; }
        @media (min-width: 1280px) { .workspace-layout { grid-template-columns: 3fr 2fr; } }

        textarea {
            width: 100%; min-height: 300px; padding: 20px; border-radius: 12px; border: 1px solid var(--border);
            background: var(--bg-app); color: var(--text-main); font-size: 16px; outline: none; box-sizing: border-box;
        }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { text-align: left; padding: 12px; color: var(--text-muted); font-size: 10px; text-transform: uppercase; border-bottom: 1px solid var(--border); }
        td { padding: 12px; border-bottom: 1px solid var(--border); }
        .num { font-family: monospace; text-align: right; font-weight: 600; }
        .total { background: var(--accent-bg); color: var(--brand); font-weight: 800; }
        .token-span { padding: 2px 4px; border-radius: 4px; margin: 1px; display: inline-block; font-family: monospace; }
        .btn { padding: 8px 14px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-main); font-weight: 600; cursor: pointer; }
        .btn-danger { color: #ef4444; border-color: #fee2e2; }
    </style>
</head>
<body>

<div class="app-grid">
    <aside id="sidebar">
        <h2 style="color:var(--brand); margin:0; font-size: 20px;">GPT Calculator</h2>
        <p style="font-size:11px; font-weight:bold; color:var(--text-muted); text-transform:uppercase; margin-top:20px;">Recent History</p>
        <div id="history-list" style="flex:1; overflow-y:auto; margin-bottom:20px;"></div>
        <button class="btn" style="width:100%; background:var(--brand); color:white; border:none; margin-bottom:8px;" onclick="saveToHistory()">ðŸ’¾ Save Workspace</button>
        <button class="btn btn-danger" style="width:100%;" onclick="clearHistory()">ðŸ—‘ Clear History</button>
    </aside>

    <header>
        <div style="display:flex; align-items:center; gap:12px;">
            <div class="btn" onclick="toggleMenu()" style="padding:5px 10px;">â˜°</div>
            <input type="search" id="search-box" placeholder="Filter models..." oninput="renderPricing()" style="padding:8px; border-radius:8px; border:1px solid var(--border);">
        </div>
        <div style="display:flex; gap:8px;">
            <button class="btn" onclick="showExample()">Example</button>
            <button class="btn" onclick="clearEditor()" style="color:#ef4444">Clear</button>
            <select id="currency-select" onchange="changeCurrency(this.value)" class="btn">
                <option value="USD">USD</option><option value="EUR">EUR</option><option value="INR">INR</option>
            </select>
        </div>
    </header>

    <main>
        <div class="stats-grid">
            <div class="glass-card" style="margin:0;">
                <small style="color:var(--text-muted); font-weight:bold;">TOKENS</small>
                <div id="t-count" style="font-size:24px; font-weight:800;">0</div>
            </div>
            <div class="glass-card" style="margin:0;">
                <small style="color:var(--text-muted); font-weight:bold;">EST. WORDS</small>
                <div id="w-count" style="font-size:24px; font-weight:800;">0</div>
            </div>
            <div class="glass-card" style="margin:0; border-left:4px solid var(--brand);">
                <small style="color:var(--text-muted); font-weight:bold;">AVG. COST (1:1 Ratio)</small>
                <div id="avg-cost" style="font-size:24px; font-weight:800; color:var(--brand);">$0.00</div>
            </div>
        </div>

        <div class="workspace-layout">
            <div>
                <textarea id="token-input" placeholder="Paste your prompts here..."></textarea>
                <div class="glass-card" style="margin-top:20px;">
                    <div id="visualizer"></div>
                </div>
            </div>
            <div class="glass-card" style="padding:0; overflow:hidden;">
                <table>
                    <thead style="background:var(--bg-app);">
                        <tr><th>Model</th><th style="text-align:right">In</th><th style="text-align:right">Out</th><th style="text-align:right">Total</th></tr>
                    </thead>
                    <tbody id="price-table-body"></tbody>
                </table>
            </div>
        </div>
    </main>
</div>

<script src="https://unpkg.com/gpt-tokenizer/dist/cl100k_base.js"></script>
<script>
    let currentTokenCount = 0; let modelData = []; let exchangeRates = { USD: 1 }; let selectedCurrency = 'USD';
    const symbols = { USD: '$', EUR: 'â‚¬', INR: 'â‚¹' };

    async function init() {
        try {
            const [mRes, rRes] = await Promise.all([fetch('models.json'), fetch('https://api.frankfurter.dev/v1/latest?base=USD')]);
            modelData = await mRes.json();
            exchangeRates = { ...exchangeRates, ...(await rRes.json()).rates };
            renderHistory(); renderPricing();
        } catch (e) { console.warn("Network error during init."); }
    }

    function toggleMenu() { document.getElementById('sidebar').classList.toggle('open'); }
    function changeCurrency(cc) { selectedCurrency = cc; renderPricing(); }
    function clearEditor() { document.getElementById('token-input').value = ''; updateUI(''); }
    function clearHistory() { if(confirm("Clear all saved workspaces?")) { localStorage.removeItem('ai_history'); renderHistory(); } }
    
    function showExample() {
        const text = "GPT Models (like gpt-4o) process text in chunks called tokens. 1,000 tokens â‰ˆ 750 words. This calculator uses the standard 2026 Price-Per-Million (1M) rates.";
        document.getElementById('token-input').value = text;
        updateUI(text);
    }

    function formatPrice(usd) {
        const val = usd * (exchangeRates[selectedCurrency] || 1);
        return symbols[selectedCurrency] + (val === 0 ? "0.00" : (val < 0.01 ? val.toFixed(4) : val.toLocaleString(undefined, {minimumFractionDigits: 2})));
    }

    function renderPricing() {
        const body = document.getElementById('price-table-body');
        const filter = document.getElementById('search-box').value.toLowerCase();
        body.innerHTML = ''; let sum = 0;
        const filtered = modelData.filter(m => m.name.toLowerCase().includes(filter));
        filtered.forEach(m => {
            const inC = (currentTokenCount / 1000000) * m.input;
            const outC = (currentTokenCount / 1000000) * m.output;
            const total = inC + outC; sum += total;
            body.innerHTML += `<tr><td><b>${m.name}</b></td><td class="num">${formatPrice(inC)}</td><td class="num">${formatPrice(outC)}</td><td class="num total">${formatPrice(total)}</td></tr>`;
        });
        document.getElementById('avg-cost').innerText = formatPrice(filtered.length ? sum / filtered.length : 0);
    }

    function updateUI(text) {
        const tokens = text ? GPTTokenizer_cl100k_base.encode(text) : [];
        currentTokenCount = tokens.length;
        document.getElementById('t-count').innerText = currentTokenCount.toLocaleString();
        document.getElementById('w-count').innerText = text.trim() ? text.trim().split(/\s+/).length.toLocaleString() : 0;
        const vis = document.getElementById('visualizer');
        vis.innerHTML = '<small style="display:block;margin-bottom:8px;color:var(--text-muted)">Token Visualization (First 100):</small>';
        tokens.slice(0, 100).forEach((id, i) => {
            const span = document.createElement('span'); span.className = 'token-span';
            span.style.background = `var(--t${(i % 4) + 1})`;
            span.textContent = GPTTokenizer_cl100k_base.decode([id]);
            vis.appendChild(span);
        });
        renderPricing();
    }

    function saveToHistory() {
        const text = document.getElementById('token-input').value; if (!text) return;
        let history = JSON.parse(localStorage.getItem('ai_history') || '[]');
        history.unshift({ id: Date.now(), text, date: new Date().toLocaleTimeString() });
        localStorage.setItem('ai_history', JSON.stringify(history.slice(0, 15)));
        renderHistory();
    }

    function renderHistory() {
        const history = JSON.parse(localStorage.getItem('ai_history') || '[]');
        document.getElementById('history-list').innerHTML = history.length ? history.map(h => `
            <div onclick="loadHistory('${h.id}')" style="padding:10px; border:1px solid var(--border); border-radius:8px; cursor:pointer; margin-bottom:8px; font-size:12px; background:var(--card-bg);">
                <b>${h.date}</b><br><span style="color:var(--text-muted)">${h.text.substring(0, 40)}...</span>
            </div>
        `).join('') : '<p style="font-size:12px; color:var(--text-muted);">No history saved.</p>';
    }

    function loadHistory(id) {
        const item = JSON.parse(localStorage.getItem('ai_history')).find(h => h.id == id);
        if (item) { document.getElementById('token-input').value = item.text; updateUI(item.text); if(window.innerWidth < 1024) toggleMenu(); }
    }

    document.getElementById('token-input').addEventListener('input', (e) => updateUI(e.target.value));
    init();
</script>
</body>
</html>
