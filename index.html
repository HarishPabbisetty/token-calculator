<script src="https://cdn.jsdelivr.net/npm/js-tiktoken@1.0.7/dist/index.min.js"></script>

<script>
    // 2. Wait for the page and library to be fully ready
    window.addEventListener('load', () => {
        try {
            // Initialize the encoder
            const enc = tiktoken.getEncoding("cl100k_base");
            const colors = ['#fee2e2', '#fef3c7', '#dcfce7', '#dbeafe', '#f3e8ff', '#fae8ff'];

            const input = document.getElementById('input');
            const visualizer = document.getElementById('visualizer');
            const tCount = document.getElementById('t-count');
            const cCount = document.getElementById('c-count');

            input.placeholder = "Tokenizer ready! Type here...";

            input.addEventListener('input', () => {
                const text = input.value;
                if (!text) {
                    tCount.innerText = '0';
                    cCount.innerText = '0';
                    visualizer.innerHTML = '';
                    return;
                }

                const tokens = enc.encode(text);
                tCount.innerText = tokens.length;
                cCount.innerText = text.length;

                visualizer.innerHTML = '';
                tokens.forEach((tokenId, index) => {
                    const chunk = enc.decode([tokenId]);
                    const span = document.createElement('span');
                    span.className = 'token-badge';
                    span.style.backgroundColor = colors[index % colors.length];
                    // Handle spaces and newlines visually
                    span.innerText = chunk; 
                    visualizer.appendChild(span);
                });
            });
        } catch (err) {
            console.error("Initialization failed:", err);
            document.querySelector('h1').innerText = "Error Loading Tokenizer";
        }
    });
</script>
